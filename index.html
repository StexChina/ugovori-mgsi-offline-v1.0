<!doctype html>
<html lang="sr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ugovori MGSI</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="js-error" style="display:none;position:fixed;top:0;left:0;right:0;background:#fee2e2;color:#991b1b;padding:8px 12px;z-index:20000;border-bottom:1px solid #fecaca;font-weight:700"></div>

  <!-- Login Screen -->
  <div id="login-screen" class="screen active">
    <div class="login-card">
      <img src="assets/mgsi_logo.svg" class="logo" alt="MGSI" />
      <h1>Ugovori MGSI</h1>
      <p class="muted" id="loginSubtitle">Prijavite se za pristup</p>
      <div class="form-row">
        <label id="lblUsername" for="username">KorisniÄko ime</label>
        <input id="username" type="text" autocomplete="username" placeholder="stefan"/>
      </div>
      <div class="form-row">
        <label id="lblPassword" for="password">Lozinka</label>
        <input id="password" type="password" autocomplete="current-password" placeholder="mgsi123"/>
      </div>
      <button class="btn primary" id="btnLogin">Prijavi se</button>
      <div class="login-meta">
        <button class="btn ghost" id="toggleThemeLogin">ğŸŒ/ğŸŒ™</button>
        <button class="btn ghost" id="toggleLangLogin">ğŸ‡·ğŸ‡¸/ğŸ‡¬ğŸ‡§</button>
      </div>
    </div>
  </div>

  <!-- App Screen -->
  <div id="app-screen" class="screen">
    <header class="app-header" role="banner">
      <div class="left">
        <img src="assets/mgsi_logo.svg" class="logo small" alt="MGSI" />
        <img src="assets/flag_rs.svg" class="flag" alt="Grb RS" />
        <h2 class="title">Ugovori MGSI</h2>
      </div>
      <div class="right">
        <button class="btn ghost" id="toggleTheme" title="Tema">ğŸŒ/ğŸŒ™</button>
        <button class="btn ghost" id="toggleLang" title="Jezik">ğŸ‡·ğŸ‡¸/ğŸ‡¬ğŸ‡§</button>
        <div class="user-chip"><span id="currentUser">stefan</span> | <a href="#" id="btnLogout">Odjava</a></div>
      </div>
    </header>

    <!-- Top Tabs (swapped NarudÅ¾benice <-> Okvirni sporazumi) -->
    <nav class="tabs" role="navigation" aria-label="Glavna navigacija">
      <button class="tab active" data-tab="ugovori" id="tabUgovori">Ugovori</button>
      <button class="tab" data-tab="narudzbenice" id="tabNarudzbenice">NarudÅ¾benice</button>
      <button class="tab" data-tab="sporazumi" id="tabSporazumi">Okvirni sporazumi</button>
      <button class="tab" data-tab="fakture" id="tabFakture">Fakture</button>
      <button class="tab" data-tab="archive" id="tabArhiva">Arhiva</button>
      <button class="tab" data-tab="komitenti" id="tabKomitenti">Komitenti</button>
      <button class="tab" data-tab="log" id="tabLog">Aktivnosti</button>
      <button class="tab" data-tab="settings" id="tabSettings">PodeÅ¡avanja</button>
      <button class="tab" data-tab="about" id="tabAbout">O projektu</button>
    </nav>

    <main class="views">
      <!-- Ugovori -->
      <section class="view active" id="view-ugovori">
        <div class="toolbar">
          <button class="btn primary" id="btnAddUgovor" type="button" onclick="try{openUgovorForm()}catch(e){alert('GreÅ¡ka: '+e.message)}" onclick="window.__onAdd && window.__onAdd('ugovor')">â• <span data-i18n="addContract">Dodaj ugovor</span></button>
          <input class="search" id="searchUgovori" placeholder="Pretragaâ€¦" />
          <div class="spacer"></div>
          <label class="inline">Gustina:
            <select id="selDensityUgovori">
              <option value="comfortable">Komforan</option>
              <option value="compact">Kompaktan</option>
            </select>
          </label>
          <label class="inline">Po strani:
            <select id="selPageUgovori">
              <option>10</option>
              <option selected>25</option>
              <option>50</option>
              <option>100</option>
            </select>
          </label>
          <button class="btn" id="btnColsUgovori">Kolone</button>
        </div>
        <div class="table-wrap">
          <table class="data-table" id="tblUgovori">
            <thead><tr id="headUgovori"></tr></thead>
            <tbody id="bodyUgovori"></tbody>
          </table>
        </div>
        <div class="table-controls" id="pgUgovori"></div>
      </section>

      <!-- NarudÅ¾benice (moved before Sporazumi) -->
      <section class="view" id="view-narudzbenice">
        <div class="toolbar">
          <button class="btn primary" id="btnAddNarudzbenica" type="button" onclick="try{openNarudzbenicaForm()}catch(e){alert('GreÅ¡ka: '+e.message)}" onclick="window.__onAdd && window.__onAdd('narudzbenica')">â• Dodaj narudÅ¾benicu</button>
          <input class="search" id="searchNarudzbenice" placeholder="Pretragaâ€¦" />
        </div>
        <div class="notice">
          Maksimalna vrednost narudÅ¾benice: 1.200.000 RSD sa PDV (1.000.000 bez PDV). Dozvoljena 1 narudÅ¾benica u 12 meseci po ugovoru.
        </div>
        <div class="table-wrap">
          <table class="data-table" id="tblNarudzbenice">
            <thead>
              <tr>
                <th>#</th><th>Broj</th><th>Ugovor</th><th>Iznos sa PDV</th><th>Iznos bez PDV</th><th>Datum</th><th>Status</th><th></th>
              </tr>
            </thead><tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Okvirni sporazumi (now after NarudÅ¾benice) -->
      <section class="view" id="view-sporazumi">
        <div class="toolbar">
          <button class="btn primary" id="btnAddSporazum" type="button" onclick="try{openSporazumForm()}catch(e){alert('GreÅ¡ka: '+e.message)}" onclick="window.__onAdd && window.__onAdd('sporazum')">â• Dodaj okvirni sporazum</button>
          <input class="search" id="searchSporazumi" placeholder="Pretragaâ€¦" />
        </div>
        <div class="table-wrap">
          <table class="data-table" id="tblSporazumi">
            <thead>
              <tr>
                <th>#</th><th>Broj</th><th>DobavljaÄ</th><th>Vrednost</th><th>Odâ€“Do</th><th>Status</th><th></th>
              </tr>
            </thead><tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Fakture -->
      <section class="view" id="view-fakture">
        <div class="toolbar">
          <button class="btn primary" id="btnAddFaktura" type="button" onclick="try{openFakturaForm()}catch(e){alert('GreÅ¡ka: '+e.message)}" onclick="window.__onAdd && window.__onAdd('faktura')">â• Dodaj fakturu</button>
          <input class="search" id="searchFakture" placeholder="Pretragaâ€¦" />
        </div>
        <div class="table-wrap">
          <table class="data-table" id="tblFakture">
            <thead>
              <tr>
                <th>#</th><th>Broj</th><th>Ugovor</th><th>Iznos</th><th>Datum</th><th>Status</th><th></th>
              </tr>
            </thead><tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Arhiva -->
      <section class="view" id="view-archive">
        <div class="toolbar"><span class="muted">Obrisane stavke (moÅ¾e vraÄ‡anje ili trajno brisanje).</span></div>
        <div class="table-wrap">
          <table class="data-table" id="tblArchive">
            <thead>
              <tr><th>#</th><th>Tip</th><th>Broj</th><th>Detalj</th><th>Obrisano</th><th></th></tr>
            </thead><tbody></tbody>
          </table>
        </div>
      </section>

      <section class="view" id="view-komitenti">
        <div class="toolbar">
          <button class="btn primary" id="btnAddKomitent" type="button" onclick="try{openKomitentForm()}catch(e){alert('GreÅ¡ka: '+e.message)}">â• Dodaj komitenta</button>
          <input class="search" id="searchKomitenti" placeholder="Pretragaâ€¦" />
        </div>
        <div class="table-wrap">
          <table class="data-table" id="tblKomitenti">
            <thead>
              <tr><th>#</th><th>Naziv</th><th>PIB</th><th>Kontakt</th><th>Napomena</th><th></th></tr>
            </thead><tbody></tbody>
          </table>
        </div>
      </section>

      <section class="view" id="view-log">
        <div class="toolbar">
          <button class="btn" id="btnExportLog">ğŸ’¾ Export log</button>
          <button class="btn danger" id="btnClearLog">ğŸ§¹ OÄisti log</button>
        </div>
        <div class="table-wrap">
          <table class="data-table" id="tblLog">
            <thead><tr><th>#</th><th>Vreme</th><th>Korisnik</th><th>Akcija</th><th>Detalji</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <section class="view" id="view-settings">
        <div class="card">
          <h3>Å abloni</h3>
          <div class="grid">
            <div><label>Interni nalog (DOCX)</label><input type="file" id="tplNaloga" accept=".doc,.docx"/></div>
            <div><label>Stanje ugovora (XLSX)</label><input type="file" id="tplStanje" accept=".xls,.xlsx"/></div>
          </div>
        </div>
        <div class="card">
          <h3>Bekap podataka</h3>
          <div class="grid">
            <button class="btn" id="btnExportData">ğŸ’¾ Export podataka (JSON)</button>
            <label class="btn">ğŸ“¥ Import podataka (JSON)
              <input type="file" id="btnImportData" accept=".json" hidden />
            </label>
          </div>
        </div>
        
        <div class="card">
          <h3>Kategorije ugovora</h3>
          <div class="grid">
            <div style="flex:2">
              <label>Dodaj novu kategoriju (npr. â€Opremaâ€œ, â€Prva pomoÄ‡â€œ)</label>
              <input type="text" id="inpNewCat" placeholder="Naziv kategorije"/>
            </div>
            <div style="display:flex; align-items:end; gap:10px">
              <button class="btn" id="btnAddCat">Dodaj kategoriju</button>
              <button class="btn" id="btnPinCats">OsvjeÅ¾i tabove</button>
            </div>
          </div>
          <p class="muted">Kategorije utiÄu na filtere u â€Ugovoriâ€œ. MoÅ¾ete ih â€prikvaÄitiâ€œ kao tabove iznad.</p>
          <div class="table-wrap" style="margin-top:8px">
            <table class="data-table" id="tblCats">
              <thead><tr><th>#</th><th>Kategorija</th><th>PrikvaÄena kao tab</th><th></th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div class="card">
          <h3>Pismo za izvoz dokumenata</h3>
          <div class="grid">
            <label><input type="radio" name="scriptChoice" value="cyr" checked> Ğ‹Ğ¸Ñ€Ğ¸Ğ»Ğ¸Ñ†Ğ° (ÑĞ»ÑƒĞ¶Ğ±ĞµĞ½Ğ¾)</label>
            <label><input type="radio" name="scriptChoice" value="lat"> Latinica (interno)</label>
            <button class="btn" id="btnSaveScript">SaÄuvaj izbor</button>
          </div>
        </div>
        <div class="card">
          <h3>Navigacija na mobilnom</h3>
          <div class="grid">
            <label><input type="radio" name="navStyle" value="top" checked> Gore (tabovi)</label>
            <label><input type="radio" name="navStyle" value="bottom"> Dole (bottom nav)</label>
            <button class="btn" id="btnSaveNavStyle">SaÄuvaj</button>
          </div>
          <p class="muted">Na desktopu su uvek gore tabovi. Na mobilnom moÅ¾eÅ¡ da biraÅ¡.</p>
        </div>
      
        <div class="card">
          <h3>Logo zaglavlja</h3>
          <div class="grid">
            <div>
              <label>UÄitaj prilagoÄ‘eni logo (PNG/SVG/JPG)</label>
              <input type="file" id="uploadLogo" accept=".png,.svg,.jpg,.jpeg"/>
            </div>
            <div style="display:flex; align-items:center; gap:10px">
              <button class="btn" id="btnResetLogo">Vrati podrazumevani</button>
              <span class="muted">Logo se Äuva lokalno (offline) i ne napuÅ¡ta raÄunar.</span>
            </div>
          </div>
        </div>

      <section class="view" id="view-about">
        <div class="card">
          <h3>O projektu</h3>
          <p>â€Ugovori MGSIâ€œ je offline aplikacija za internu evidenciju ugovora, okvirnih sporazuma i narudÅ¾benica u MGSI.</p>
          <ul>
            <li>Verzija: v1.2.1 (08.10.2025)</li>
            <li>Autor: Stefan RadoÅ¡eviÄ‡ (MGSI) & GPT-5</li>
            <li>Kontakt: intern</li>
          </ul>
        </div>
      </section>
    </main>

    <!-- Bottom Nav (swapped order too) -->
    <nav class="bottom-nav" role="navigation" aria-label="Mobilna navigacija">
      <button data-tab="ugovori"><span class="ico">ğŸ“„</span><span>Ugovori</span></button>
      <button data-tab="narudzbenice"><span class="ico">ğŸ§¾</span><span>NarudÅ¾b.</span></button>
      <button data-tab="sporazumi"><span class="ico">ğŸ“‘</span><span>Sporazumi</span></button>
      <button data-tab="fakture"><span class="ico">ğŸ’¼</span><span>Fakture</span></button>
      <button data-tab="settings"><span class="ico">âš™ï¸</span><span>PodeÅ¡.</span></button>
    </nav>
  </div>

  <script src="script.js"></script>
  <script>
    window.addEventListener('error', function(e){
      var box=document.getElementById('js-error');
      if(!box) return;
      box.style.display='block';
      box.textContent='GreÅ¡ka u skripti: ' + (e && e.message ? e.message : 'nepoznato');
    });
  </script>
</body>
</html>
